syntax = "proto3";

package omas.internal.settlement;

import "google/protobuf/timestamp.proto";

import "omas/type/financial_settlement.proto";
import "omas/type/billing_account_snapshot.proto";

option csharp_namespace = "Omas.Protos";

message StoredSettlement {
	  //10-12: legacy dual usage with DataMessage
	  reserved 10 to 12; 

	  int32 schema_version = 1;

	  // Full resource state (draft/finalized)
	  omas.type.FinancialSettlement settlement = 2;

	  // Immutable snapshot of billing account at finalization
	  omas.type.BillingAccountSnapshot billing_account = 8;

	  // Immutable snapshot of line items at finalization
	  repeated omas.type.FinancialSettlementLineItem line_items = 9;   

	  google.protobuf.Timestamp update_time = 15;

	  // Timestamp when finalizing process started. Used to detect stale finalizing
	  // settlements that may need retry (e.g., if process crashed mid-finalization).
	  // Cleared when finalization completes successfully.
	  google.protobuf.Timestamp finalizing_started_at = 16;

}